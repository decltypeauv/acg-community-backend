version: '3.8'

services:
  # --- æœåŠ¡ 1: MySQL æ•°æ®åº“ ---
  mysqldb:
    image: mysql:8.0
    container_name: acg-mysql
    restart: always
    environment:
      # âš ï¸ è¿™é‡Œçš„å¯†ç å¿…é¡»å’Œä½  application.properties é‡Œå†™çš„ä¸€æ ·ï¼
      # æˆ–è€…æ˜¯æˆ‘ä»¬åœ¨è¿™é‡Œå®šä¹‰æ–°å¯†ç ï¼Œç„¶åå¼ºåˆ¶ App ä½¿ç”¨è¿™ä¸ªå¯†ç 
      MYSQL_ROOT_PASSWORD: 123456
      MYSQL_DATABASE: acg_forum
    ports:
      - "3307:3306" # æ˜ å°„åˆ°å®¿ä¸»æœº3307ï¼Œé˜²æ­¢è·Ÿä½ æœ¬åœ°è¿è¡Œçš„MySQL(3306)å†²çª
    volumes:
      - db_data:/var/lib/mysql # æ•°æ®æŒä¹…åŒ–ï¼Œé‡å¯å®¹å™¨æ•°æ®ä¸ä¸¢
    command: --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci

  # --- æœåŠ¡ 2: Spring Boot åº”ç”¨ ---
  acg-app:
    build: . # ä½¿ç”¨å½“å‰ç›®å½•çš„ Dockerfile æ„å»º
    container_name: acg-backend
    restart: always
    ports:
      - "8080:8080" # å¤–éƒ¨è®¿é—®ç«¯å£:å®¹å™¨å†…éƒ¨ç«¯å£
    environment:
      # ğŸš€ å…³é”®é­”æ³•ï¼šè¦†ç›– application.properties é‡Œçš„é…ç½®
      # å‘Šè¯‰ Spring Boot æ•°æ®åº“ä¸åœ¨ localhostï¼Œè€Œåœ¨ mysqldb è¿™ä¸ªå®¹å™¨é‡Œ
      SPRING_DATASOURCE_URL: jdbc:mysql://mysqldb:3306/acg_forum?useSSL=false&serverTimezone=UTC&allowPublicKeyRetrieval=true
      SPRING_DATASOURCE_PASSWORD: 123456
      # é…ç½®æ–‡ä»¶ä¸Šä¼ è·¯å¾„ (å®¹å™¨å†…çš„è·¯å¾„)
      FILE_UPLOAD_DIR: /uploads
    volumes:
      # ğŸ“‚ å…³é”®ï¼šæŠŠå®¹å™¨é‡Œçš„ /uploads æ˜ å°„åˆ°ä½ ç”µè„‘å½“å‰ç›®å½•ä¸‹çš„ uploads æ–‡ä»¶å¤¹
      # è¿™æ ·ä¸Šä¼ çš„å›¾ç‰‡ä¼šç›´æ¥ä¿å­˜åœ¨ä½ ç°åœ¨çš„é¡¹ç›®æ–‡ä»¶å¤¹é‡Œï¼
      - ./uploads:/uploads
    depends_on:
      - mysqldb # ç¡®ä¿æ•°æ®åº“å…ˆå¯åŠ¨

# å®šä¹‰æ•°æ®å·
volumes:
  db_data: